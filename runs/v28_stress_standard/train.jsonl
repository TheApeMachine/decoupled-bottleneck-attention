{"type":"meta","step":0,"env":{"time":"2025-12-17T07:15:52+01:00","python":"3.12.12 (main, Oct  9 2025, 11:07:00) [Clang 17.0.0 (clang-1700.0.13.3)]","platform":"macOS-15.6-arm64-arm-64bit","torch":"2.9.1","device":"mps","triton_available":false},"argv":["v28_transformer_decoupled_bottleneck_instrumented.py","--data","fineweb_100m.tokens","--data-format","text","--out-dir","runs/v28_stress_standard","--attn-mode","standard","--d-model","1024","--layers","12","--block","2048","--batch-size","1","--grad-accum","1","--optimizer","lion","--grad-checkpoint","--instrument","basic"],"args":{"size":null,"exp":null,"run_root":"runs","run_tag":null,"print_config":false,"data":"fineweb_100m.tokens","data_format":"text","data_dtype":"uint16","vocab_size":null,"val_frac":0.1,"out_dir":"runs/v28_stress_standard","seed":1337,"device":null,"compile":false,"compile_mode":"default","amp":false,"amp_dtype":"bf16","param_dtype":"fp32","matmul_precision":"high","layers":12,"d_model":1024,"n_head":8,"d_ff":2048,"block":2048,"embed_dim":512,"attn_mode":"standard","kv_head":null,"attn_dim":512,"sem_dim":32,"geo_dim":64,"no_rope":false,"rope":false,"rope_base":10000.0,"tie_qk":false,"no_tie_qk":false,"null_attn":false,"no_null_attn":false,"no_learned_temp":false,"mlp":"swiglu","dropout":0.0,"steps":6000,"batch_size":1,"grad_accum":1,"train_seq_len":0,"seq_schedule":null,"eval_seq_len":0,"grad_checkpoint":true,"optimizer":"lion","adam_betas":"0.9,0.95","adam_eps":1e-08,"lion_betas":"0.9,0.99","lr":0.0003,"lr_schedule":"constant","warmup_steps":0,"min_lr":0.0,"opt_foreach":false,"opt_fused":false,"weight_decay":0.1,"grad_clip":1.0,"save_every":0,"eval_every":200,"eval_iters":20,"log_every":100,"instrument":"basic","analysis_every":100,"analysis_max_tokens":256,"analysis_layers":"0,-1","analysis_heads":"0","analysis_topk":8,"analysis_local_window":32,"analysis_save_scores":false,"live":"auto","live_update_every":1,"sync_timing":false,"live_plot":false,"tb":false,"mode":"train","ckpt":null,"prompt_tokens":"0","max_new_tokens":50,"temperature":1.0,"top_k":null,"kv_cache":"fp16","kv_qblock":32,"kv_residual":128,"kv_decode_block":1024,"kv_fused":"auto","self_opt":"none","self_opt_cache":null,"self_opt_decode_blocks":"256,512,1024,2048","self_opt_block_n":"128","self_opt_warps":"4,8","self_opt_stages":"2,3","self_opt_warmup":1,"self_opt_iters":3,"self_opt_interval":256,"self_opt_hysteresis":0.03,"self_opt_verbose":false,"self_opt_verify":false,"self_opt_verify_tol":0.005,"self_opt_scope":"all","self_opt_residuals":"0,32,64,128","self_opt_qblocks":"16,32,64","self_opt_k_sem_kinds":"q4_0,nf4,q8_0,fp16","self_opt_k_geo_kinds":"q8_0,q4_0,fp16","self_opt_v_kinds":"q4_0,q8_0,fp16","self_opt_mem_budget_mb":null,"self_opt_mem_overhead_frac":0.1,"self_opt_policy_prefix_len":null,"self_opt_policy_warmup":1,"self_opt_policy_iters":3,"self_opt_policy_hysteresis":0.02,"self_opt_prefer_low_mem_within":0.02,"self_opt_policy_quality":false,"self_opt_calib_tokens":null,"self_opt_calib_prefill":64,"self_opt_calib_decode":8,"self_opt_quality_tol":0.5,"kv_cache_k":null,"kv_cache_v":null,"kv_cache_k_sem":null,"kv_cache_k_geo":null,"kv_qblock_k":null,"kv_qblock_v":null,"kv_qblock_k_sem":null,"kv_qblock_k_geo":null,"tokenizer":"word"},"config":{"vocab_size":50257,"block_size":2048,"n_layer":12,"n_head":8,"kv_head":null,"d_model":1024,"d_ff":2048,"embed_dim":512,"attn_mode":"standard","attn_dim":512,"sem_dim":32,"geo_dim":64,"rope":true,"rope_base":10000.0,"tie_qk":false,"null_attn":false,"learned_temp":true,"mlp":"swiglu","dropout":0.0},"wall_time":"2025-12-17T07:15:52+01:00"}
{"type":"mem","step":0,"kv_ctx_bytes":100663296,"kv_128k_bytes":6291456000,"data_format":"text","data_dtype":"uint16","n_tokens_total":100002129,"n_tokens_train":90001916,"n_tokens_val":10000213,"vocab_size":50257,"wall_time":"2025-12-17T07:15:52+01:00"}
{"type":"eval","step":0,"train_loss":10.894817209243774,"val_loss":10.880640506744385,"val_ppl":53137.62402717936,"best_val":10.880640506744385,"wall_time":"2025-12-17T07:15:57+01:00"}
{"type":"train","step":1,"loss":10.869585037231445,"ppl":52553.39804153867,"lr":0.0003,"tok_s":3850.290203935249,"seq_len":2048,"grad_accum":1,"global_batch":1,"step_ms":531.9079579785466,"data_ms":0.11191598605364561,"fwd_ms":62.49987496994436,"bwd_ms":272.01545803109184,"opt_ms":197.11441703839228,"grad_clip_norm":9.041961669921875,"opt_state_bytes":610642304,"mps_mem_alloc_bytes":3418601728.0,"mps_mem_driver_bytes":5120393216.0,"cpu_rss_bytes":3039150080.0,"grad_norm_embed":0.5456027661596808,"grad_norm_attn":0.6784308575058341,"grad_norm_ffn":0.4892756477048998,"grad_norm_attn_sem":0.0,"grad_norm_attn_geo":0.0,"grad_norm_total":0.9986698484956107,"wall_time":"2025-12-17T07:15:58+01:00"}
{"type":"analysis","step":100,"attn_entropy_mean":1.5899856984615326,"attn_topk_mass_mean":0.7682147026062012,"attn_local_mass_mean":0.5152208656072617,"attn_erank_mean":67.21540260314941,"proj_stable_rank_mean":7.960804338349028,"wall_time":"2025-12-17T07:16:45+01:00"}
{"type":"train","step":100,"loss":34.02835464477539,"ppl":600242373119178.9,"lr":0.0003,"tok_s":4307.442668580717,"seq_len":2048,"grad_accum":1,"global_batch":1,"step_ms":475.4561250317945,"data_ms":0.18867678620448017,"fwd_ms":19.202831281805317,"bwd_ms":309.3644410913876,"opt_ms":146.55471174869535,"grad_clip_norm":71.13993072509766,"opt_state_bytes":610642304,"mps_mem_alloc_bytes":3291273472.0,"mps_mem_driver_bytes":6107185152.0,"cpu_rss_bytes":3082207232.0,"grad_norm_embed":0.9992418469034805,"grad_norm_attn":0.004090925181865358,"grad_norm_ffn":0.012318448042946531,"grad_norm_attn_sem":0.0,"grad_norm_attn_geo":0.0,"grad_norm_total":0.9993261471782419,"wall_time":"2025-12-17T07:16:45+01:00"}
{"type":"eval","step":200,"train_loss":8.90556788444519,"val_loss":8.93720726966858,"val_ppl":7609.914911641471,"best_val":8.93720726966858,"wall_time":"2025-12-17T07:17:39+01:00"}
{"type":"analysis","step":200,"attn_entropy_mean":0.1264285035431385,"attn_topk_mass_mean":0.999998539686203,"attn_local_mass_mean":0.5466666668653488,"attn_erank_mean":37.75123596191406,"proj_stable_rank_mean":5.569873436851816,"wall_time":"2025-12-17T07:17:39+01:00"}
{"type":"train","step":200,"loss":0.5415636897087097,"ppl":1.7186922634753345,"lr":0.0003,"tok_s":4272.627675687456,"seq_len":2048,"grad_accum":1,"global_batch":1,"step_ms":479.3303220998496,"data_ms":0.2262950170552358,"fwd_ms":18.84196618979331,"bwd_ms":311.86586293799337,"opt_ms":148.21644499897957,"grad_clip_norm":4.902010440826416,"opt_state_bytes":610642304,"mps_mem_alloc_bytes":3290519808.0,"mps_mem_driver_bytes":6107185152.0,"cpu_rss_bytes":3156590592.0,"grad_norm_embed":0.9994290019051233,"grad_norm_attn":0.0016008573254851144,"grad_norm_ffn":0.01329312814590126,"grad_norm_attn_sem":0.0,"grad_norm_attn_geo":0.0,"grad_norm_total":0.9995186840920738,"wall_time":"2025-12-17T07:17:39+01:00"}
{"type":"analysis","step":300,"attn_entropy_mean":0.06481625512242317,"attn_topk_mass_mean":1.0,"attn_local_mass_mean":0.6236935555934906,"attn_erank_mean":61.06235694885254,"proj_stable_rank_mean":4.996886520190852,"wall_time":"2025-12-17T07:18:27+01:00"}
{"type":"train","step":300,"loss":0.4203285574913025,"ppl":1.5224616896460983,"lr":0.0003,"tok_s":4226.886670002932,"seq_len":2048,"grad_accum":1,"global_batch":1,"step_ms":484.51736701012123,"data_ms":0.25334580976050347,"fwd_ms":19.346564190927893,"bwd_ms":315.62608884240035,"opt_ms":149.12061546521727,"grad_clip_norm":0.5182377696037292,"opt_state_bytes":610642304,"mps_mem_alloc_bytes":3290781952.0,"mps_mem_driver_bytes":6107185152.0,"cpu_rss_bytes":3166928896.0,"grad_norm_embed":0.5178138605819755,"grad_norm_attn":0.0023783515674975107,"grad_norm_ffn":0.00539188787298617,"grad_norm_attn_sem":0.0,"grad_norm_attn_geo":0.0,"grad_norm_total":0.5178473937578744,"wall_time":"2025-12-17T07:18:27+01:00"}
{"type":"eval","step":400,"train_loss":11.979830932617187,"val_loss":11.995141649246216,"val_ppl":161965.989245793,"best_val":8.93720726966858,"wall_time":"2025-12-17T07:19:23+01:00"}
{"type":"analysis","step":400,"attn_entropy_mean":0.04542187787592411,"attn_topk_mass_mean":1.0,"attn_local_mass_mean":0.6693164110183716,"attn_erank_mean":57.52952575683594,"proj_stable_rank_mean":4.901318303077387,"wall_time":"2025-12-17T07:19:23+01:00"}
{"type":"train","step":400,"loss":0.4164959490299225,"ppl":1.5166378574552994,"lr":0.0003,"tok_s":4006.5370654674257,"seq_len":2048,"grad_accum":1,"global_batch":1,"step_ms":511.1646208522143,"data_ms":0.24399079382419586,"fwd_ms":19.51434832822997,"bwd_ms":333.2434737577569,"opt_ms":157.97960665717255,"grad_clip_norm":1.3811652660369873,"opt_state_bytes":610642304,"mps_mem_alloc_bytes":3290519808.0,"mps_mem_driver_bytes":6107185152.0,"cpu_rss_bytes":3177906176.0,"grad_norm_embed":0.9993246843895838,"grad_norm_attn":0.0009161049790777715,"grad_norm_ffn":0.011094752849117123,"grad_norm_attn_sem":0.0,"grad_norm_attn_geo":0.0,"grad_norm_total":0.9993866907356016,"wall_time":"2025-12-17T07:19:23+01:00"}
{"type":"analysis","step":500,"attn_entropy_mean":0.0760915782302618,"attn_topk_mass_mean":0.9999991357326508,"attn_local_mass_mean":0.6983719766139984,"attn_erank_mean":72.8720474243164,"proj_stable_rank_mean":5.362328392420643,"wall_time":"2025-12-17T07:20:21+01:00"}
{"type":"train","step":500,"loss":9.326784133911133,"ppl":11234.943255435586,"lr":0.0003,"tok_s":3522.352044255814,"seq_len":2048,"grad_accum":1,"global_batch":1,"step_ms":581.4296737714903,"data_ms":0.24001704528927803,"fwd_ms":23.391910357167944,"bwd_ms":377.0068300224375,"opt_ms":180.55182913609315,"grad_clip_norm":8.366134643554688,"opt_state_bytes":610642304,"mps_mem_alloc_bytes":3290781952.0,"mps_mem_driver_bytes":6107185152.0,"cpu_rss_bytes":3187949568.0,"grad_norm_embed":0.9988859005683836,"grad_norm_attn":0.002824716193901382,"grad_norm_ffn":0.018123842818051142,"grad_norm_attn_sem":0.0,"grad_norm_attn_geo":0.0,"grad_norm_total":0.9990543003532792,"wall_time":"2025-12-17T07:20:21+01:00"}
{"type":"eval","step":600,"train_loss":11.02027907371521,"val_loss":11.081151962280273,"val_ppl":64935.643751643525,"best_val":8.93720726966858,"wall_time":"2025-12-17T07:21:20+01:00"}
{"type":"analysis","step":600,"attn_entropy_mean":0.027013864368200302,"attn_topk_mass_mean":1.0,"attn_local_mass_mean":0.6910516917705536,"attn_erank_mean":75.1631851196289,"proj_stable_rank_mean":5.337269859673837,"wall_time":"2025-12-17T07:21:20+01:00"}
{"type":"train","step":600,"loss":0.07034485787153244,"ppl":1.072878107925201,"lr":0.0003,"tok_s":3791.215612278531,"seq_len":2048,"grad_accum":1,"global_batch":1,"step_ms":540.1961295388173,"data_ms":0.22122035268694162,"fwd_ms":21.24979044427164,"bwd_ms":351.0192437184742,"opt_ms":167.5154879380716,"grad_clip_norm":0.721746027469635,"opt_state_bytes":610642304,"mps_mem_alloc_bytes":3290519808.0,"mps_mem_driver_bytes":6107185152.0,"cpu_rss_bytes":3194945536.0,"grad_norm_embed":0.7207429369773899,"grad_norm_attn":0.0005200013011846712,"grad_norm_ffn":0.006837179081743729,"grad_norm_attn_sem":0.0,"grad_norm_attn_geo":0.0,"grad_norm_total":0.7207755535684759,"wall_time":"2025-12-17T07:21:20+01:00"}
